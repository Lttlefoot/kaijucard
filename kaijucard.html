<!DOCTYPE html>
<html>
<head>
	<title>Kaiju Card</title>
	<style type="text/css">
		body {
			width: 960px;
			height: 540px;
			margin: 0;
			font-family: "Garamond";
		}

		body > div {
			overflow: hidden;
			background: linear-gradient(to right, #ddffdd, #ffdddd);
			height: 100%;
			display: none;
		}

		#mainScreen {
			display: block;
		}

		#mainTitle {
			text-align: center;
		}

		.bigWord {
			font-size: 6em;
			margin: 30px;
		}

		#mainButtons {
			text-align: center;
			width: 44%;
			margin: 50px auto;
		}

		#mainButtons button {
			margin: 25px;
		}

		#ruleTitle {
			text-align: center;
			height: 20%;
			padding: 10px;
			box-sizing: border-box;
		}

		#ruleText {
			height: 80%;
			overflow-y: scroll;
			padding-left: 25%;
			padding-right: 25%;
		}

		#deckScreen > div {
			box-sizing: border-box;
			border: 1px solid black;
		}

		#deckTitle {
			text-align: center;
			height: 20%;			
		}

		#deckTitle  button {
			margin: 15px;
		}

		#deckLibrary {
			height: 80%;
			width: 70%;
			overflow-y: scroll;
			float: left;
		}

		#deckList {
			height: 80%;
			width: 30%;
			overflow-y: scroll;
			padding-left: 20px;
		}

		.libraryItem {
			border-bottom: 1px solid black;
			height: 100px;
			width: 100%;
		}

		.libraryItem > div {
			float: left;			
		}

		.libraryNum {
			font-size: 4em;
			margin-left: 20px;
			margin-right: 20px;
			margin-top: 15px;
		}

		.card {
			height: 90px;
			width: 70px;
			margin: 4px;
			border: 1px solid black;
			overflow: hidden;
			text-align: left;
			white-space: normal;
		}

		.card p {
			margin: 2px;
		}

		.cardLocation { background-color: white; }

		.uncastable {
			background-color: black;
			color: white;
		}

		.cardText { font-size: 0.5em; }

		.add1, .add5, .remove1, .remove5, #cancelLg {
			margin-top: 40px;
			margin-left: 15px;
			margin-right: 15px;
		}

		.listItem {
			display: none;
		}

		#cardPopupDeck {
			display: none;
			position: absolute;
			text-align: center;
			top: 144px;
			left: 180px;
			width: 600px;
			height: 200px;
			background-color: white;
			padding: 20px;
		}

		#savePopup {
			display: none;
			position: absolute;
			top: 120px;
			left: 280px;
			width: 400px;
			height: 200px;
			background-color: white;
			text-align: center;
			padding: 40px;
		}

		#savePopup button {
			width: 60px;
			margin: 10px;
		}

		#savePopup input {
			margin: 10px;
		}

		#winScreen {
			text-align: center;
			background-image: none;
			background-color: #ddffdd;
		}

		#loseScreen {
			text-align: center;
			background-image: none;
			background-color: #ffdddd;
		}

		#gameScreen > div {
			/*border: 1px solid black;*/
			box-sizing: border-box;
			float: left;
		}

		#gameMessageBox {
			height: 75%;
			width: 20%;
			padding-left: 25px;
			padding-right: 25px;
			padding-top: 80px;
		}

		#redText {
			color: red;
			font-size: 1.8em;
			position: absolute;
			top: 7px;
			left: 27px;
		}

		#blackText { 
			font-size: 1.8em;
			position: absolute;
			top: 5px;
			left: 25px;
		}

		#moneyNum {
			font-size: 2.2em;
			margin-top: 20px;
			margin-bottom: 20px;
		}

		#gameHPBox {
			height: 10%;
			width: 80%;
			padding-top: 15px;
			padding-left: 80px;
		}

		#outerHP {
			height: 12px;
			width: 600px;
			border: 1px solid black;
			margin-right: 20px;
			float: left;
		}

		#innerHP {
			height: 100%;
			width: 100%;
			background-color: #ee88bb;
		}

		#numHP { float: left; }

		#gameMechBox, #gameMonsterBox {
			width: 20%;
			height: 65%;
		}

		#gameTileBox {
			width: 40%;
			height: 65%;
			padding-left: 30px;
			padding-top: 2px;
		}

		#gameTileBox > div {
			height: 81px;
			width: 81px;
			box-sizing: border-box;
			border-top: 1px solid black;
			border-left: 1px solid black;
			float: left;
			font-size: 0.8em;
			padding-left: 10px;
		}

		.rightTile { border-right: 1px solid black; }

		.bottomTile {border-bottom: 1px solid black;}

		.tileImage {
			font-family: "Courier New";
			float: left;
			margin-right: 15px;
			padding-top: 5px;
		}

		.tileHP {
			font-size: 1.6em;
			color: purple;
			text-align: right;
			padding-right: 10px;
		}

		#gameCardBox {
			overflow-x: scroll;
			width: 90%;
			height: 25%;
			text-align: center;
			white-space: nowrap;
		}

		#gameCardBox > div {
			display: inline-block;
		}

		#gameScreen > button {
			margin-left: 10px;
			margin-top: 30px;
		}
		
	</style>
</head>
<body>
	<div id="mainScreen">
		<div id="mainTitle">
			<em><h1 class="bigWord">Kaiju Card</h1></em>
			<p>by Tony Youssef</p>
		</div>
		<div id="mainButtons">
			
			<hr>
			<p>Current deck:   
			<select id="deckSelect">
				<option value = "(Basic) Burn">(Basic) Burn</option>
				<option value = "(Basic) Money">(Basic) Money</option>
				<option value = "(Basic) Turrets">(Basic) Turrets</option>
			</select></p>
			
			<hr>
			<p></p>
			<button onclick="newDeck()">New Deck</button>
			<button onclick="editDeck()">Edit Deck</button>
			<button onclick="rules()">Rules</button>
			<p></p>
			<button onclick="beginNormal()">New Game (Normal)</button>
			<button onclick="beginHard()">New Game (Hard)</button>
		</div>
	</div>

	<div id="ruleScreen">
		<div id="ruleTitle">
		<button onclick="rulesToMain()">Back to Main Menu</button>
		<h1>Rules</h1>
		</div>
		<div id="ruleText">
			<p>Lorem ipsum</p>
			<p>Bacon ipsum dolor amet strip steak tenderloin shankle pork chop. Spare ribs chuck flank turkey frankfurter salami cupim tail bacon. Flank ground round salami ham, leberkas sirloin boudin buffalo landjaeger prosciutto. Tail capicola hamburger, venison beef ribs swine short ribs boudin kielbasa. Biltong ribeye jerky shankle, t-bone pork loin filet mignon. Ribeye short ribs turducken venison pork belly pancetta burgdoggen fatback tri-tip jerky cow shank filet mignon capicola. Ground round andouille buffalo pork belly pastrami beef boudin.</p>

			<p>Kielbasa chuck hamburger boudin bresaola sausage jowl. Bresaola burgdoggen alcatra cupim turkey landjaeger short loin. Frankfurter boudin kielbasa turkey, sirloin bacon beef ribs salami shank fatback burgdoggen jerky chuck. Ham hock tongue pork loin prosciutto. Meatball frankfurter short loin prosciutto, tenderloin chicken picanha beef ribs biltong sausage pig cow turducken. Shoulder flank salami, capicola hamburger ham hock bacon sirloin tongue bresaola pork chop shank chicken prosciutto. Shoulder bacon beef, leberkas beef ribs pork loin bresaola salami corned beef spare ribs sirloin ham hock.</p>

			<p>T-bone brisket fatback pork chop. Tri-tip bacon turducken bresaola drumstick. Tenderloin alcatra strip steak landjaeger shank boudin tongue jowl buffalo pork loin shankle ribeye kevin pastrami flank. Ribeye short loin turducken, bresaola ground round tri-tip andouille. Corned beef tri-tip chuck brisket pastrami swine salami shank ground round.</p>
		</div>
	</div>

	<div id="deckScreen">
		<div id="deckTitle">
		<div><span id="deckNameDeck"></span>  
			<button onclick="deckToMain()">Back to Main Menu (without saving)</button>
		</div>
		<button onclick="saveOverF()" id="saveOver">Save (overwrite)</button>
		<button onclick="saveNewF()" id="saveNew">Save as new deck</button>
		<button onclick="delDeckF()" id="delDeck">Delete deck</button>
		</div>
		<div id="deckLibrary">
			<div class="libraryItem">
				<div class="libraryNum">0</div>
				<div class="card">
					<strong><p class="cardName"></p></strong>
					<p class="cardCost"></p>
					<p class="cardLocation"></p>
					<p class="cardText"></p>
				</div>
				<div>
					<button class="add1">Add 1</button>
					<button class="add5">Add 5</button>
					<button class="remove1">Remove 1</button>
					<button class="remove5">Remove 5</button>
				</div>
			</div>
		</div>
		<div id="deckList">
			<strong><p>Total cards <span id="totalCards">0</span>/40</p></strong>
			<p class="listItem"><span class="listNum">0</span> <span class="listName"></span></p>
		</div>
		<div id="cardPopupDeck">
			<strong><p id="cardNameLg"></p></strong>
			<p id="cardTextLg"></p>
			<button class="add1">Add 1</button>
			<button class="add5">Add 5</button>
			<button class="remove1">Remove 1</button>
			<button class="remove5">Remove 5</button>
			<button id="cancelLg" onclick="cancelLg()">Close</button>
		</div>
		<div id="savePopup">
			<div id="saveTip"></div>
			<input type="text" id="saveName" onkeyup="saveEnter()">
			<div>
				<button onclick="saveOK()">OK</button>
				<button onclick="saveCancel()">Cancel</button>
			</div>
		</div>
	</div>

	<div id="winScreen">
		<h1 class="bigWord">You Win!</h1>
		<p>The city is safe.</p>
		<button onclick="winToMain()">Back to Main Menu</button>
	</div>

	<div id="loseScreen">
		<h1 class="bigWord">Game Over</h1>
		<p>The city is destroyed.</p>
		<button onclick="loseToMain()">Back to Main Menu</button>
	</div>

	<div id="gameScreen">
		<div id="gameMessageBox">
			<p id="redText"></p>
			<p id="blackText"></p>
			<hr>
			<p id="turnNum"></p>
			<p id="incomeNum"></p>
			<p id="energyNum"></p>
			<hr>
			<p id="moneyNum"></p>
			<hr>
			<p id="phaseDetail"></p>
			<button id="cancelTarget" onclick="cancelTargetF()">Cancel</button>
		</div>
		<div id="gameHPBox">
			<div id="outerHP"><div id="innerHP"></div></div><div id="numHP"></div>
		</div>
		<div id="gameMechBox">
			<canvas width="192" height ="351"></canvas>
		</div>
		<div id="gameTileBox">
			<div></div><div></div><div></div><div class="rightTile"></div>
			<div></div><div></div><div></div><div class="rightTile"></div>
			<div></div><div></div><div></div><div class="rightTile"></div>
			<div class="bottomTile"></div><div class="bottomTile"></div><div class="bottomTile"></div><div class="bottomTile rightTile"></div>
		</div>
		<div id="gameMonsterBox">
			<canvas width="192" height ="351"></canvas>
		</div>
		<div id="gameCardBox">

		</div>
		<button onclick="endTurn()">End Turn</button>
	</div>

<script type="text/javascript">
	mainScreen = document.getElementById("mainScreen");
	ruleScreen = document.getElementById("ruleScreen");
	gameScreen = document.getElementById("gameScreen");
	deckNameDeck = document.getElementById("deckNameDeck");
	deckSelect = document.getElementById("deckSelect");
	saveOver = document.getElementById("saveOver");
	saveNew = document.getElementById("saveNew");
	delDeck = document.getElementById("delDeck");
	savePopup = document.getElementById("savePopup");
	saveTip = document.getElementById("saveTip");
	saveName = document.getElementById("saveName");
	libraryItem = document.querySelector(".libraryItem");
	deckLibrary = document.getElementById("deckLibrary");
	listItem = document.querySelector(".listItem");
	deckList = document.getElementById("deckList");
	totalCards = document.getElementById("totalCards");
	cardPopupDeck = document.getElementById("cardPopupDeck");
	cardTextLg = document.getElementById("cardTextLg");
	cardNameLg = document.getElementById("cardNameLg");
	gameCardBox = document.getElementById("gameCardBox");
	numHP = document.getElementById("numHP");
	innerHP = document.getElementById("innerHP");
	turnNum = document.getElementById("turnNum");
	incomeNum = document.getElementById("incomeNum");
	energyNum = document.getElementById("energyNum");
	moneyNum = document.getElementById("moneyNum");
	phaseDetail = document.getElementById("phaseDetail");
	cancelTarget = document.getElementById("cancelTarget");

	var cardDictionary = {
		Ancestors: {
			cost: 40,
			location: "None",
			text: "Draw 3 cards",
			cast: function() { drawCard(); drawCard(); drawCard(); }
		},
		Battery: {
			cost: 0,
			location: "Any",
			text: "Mech gets +1 energy"
		},
		Bells: {
			cost: 0,
			location: "Church",
			duration: 1,
			text: "Church gets high threat for 1 turn. Draw a card"
		},
		"Black Hole": {
			cost: 90,
			location: "None",
			text: "The monster loses 25% of its current hp",
			cast: function() { shoot(Math.ceil(monsterHP * 0.25)); }
		},
		Build: {
			cost: 50,
			location: "Any",
			text: "Tile gets +1 hp",
			cast: function() { currentTile.addHP(1); }
		},
		"Build+": {
			cost: 100,
			location: "Any",
			text: "Tile gets +2 hp",
			cast: function() { currentTile.addHP(2); }
		},
		Burn: {
			cost: 20,
			location: "None",
			text: "Deal 40 damage",
			cast: function() { shoot(40); }
		},
		"Burn+": {
			cost: 50,
			location: "None",
			text: "Deal 70 damage",
			cast: function() { shoot(70); }
		},
		Concuss: {
			cost: 50,
			location: "None",
			text: "Deal 50 damage. Monster attacks 1 less time next turn, up to 3 times per turn"
		},
		"Cow Launcher": {
			cost: 0,
			location: "Farm",
			duration: 3,
			text: "Add 3 turrets to your farm for 3 turns"
		},
		Distract: {
			cost: 0,
			location: "None",
			text: "Monster heals 1000hp. Monster attacks 1 less time next turn, up to 3 times per turn"
		},
		"Divine Favor": {
			cost: 150,
			location: "Church",
			text: "Draw an extra card each turn"
		},
		"Divine Protection": {
			cost: 250,
			location: "Church",
			text: "-1 attack on rampage. Stacks thrice"
		},
		Eat: {
			cost: 0,
			location: "Farm",
			text: "Reduce farm's monster healing by 1000. Stacks thrice"
		},
		Explosion: {
			cost: 0,
			location: "Any",
			text: "Deal 1 damage to your own tile and 100 damage to the monster"
		},
		Gamble: {
			cost: 20,
			location: "None",
			text: "You have a 50% chance to gain $40 this turn"
		},
		"Golden Gun": {
			cost: 0,
			location: "Bank",
			duration: 2,
			text: "Deal 100 damage. This bank gains high threat for 2 turns"
		},
		Grant: {
			cost: 0,
			location: "None",
			text: "Gain $10 this turn",
			cast: function() { addMoney(10); }
		},
		"Hidden Turret": {
			cost: 0,
			location: "Any",
			duration: 2,
			text: "Tile gets low threat for 2 tuns. Tile gets a turret"
		},
		Income: {
			cost: 30,
			location: "Bank",
			text: "Bank generates +$10/turn",
			cast: function() { currentTile.income += 10; addIncome(10); }
		},
		"Income+": {
			cost: 60,
			location: "Bank",
			text: "Bank generates +$20/turn",
			cast: function() { currentTile.income += 20; addIncome(20); }
		},
		Laser: {
			cost: 0,
			location: "None",
			text: "Deal 20 damage for each energy you have"
		},
		"Laser+": {
			cost: 0,
			location: "None",
			text: "Deal 50 damage for each energy you have"
		},
		Loan: {
			cost: 0,
			location: "None",
			text: "Discard 2 cards. Gain $40 this turn"
		},
		Market: {
			cost: 90,
			location: "Farm",
			text: "Farm generates +$30 per turn",
			cast: function() { currentTile.income += 30; addIncome(30); }
		},
		Melt: {
			cost: 100,
			location: "None",
			text: "Spend all your remaining money this turn. Deal that much damage"
		},
		Missile: {
			cost: 0,
			location: "None",
			text: "Deal 50 damage and draw a card"
		},
		"Missile+": {
			cost: 0,
			location: "None",
			text: "Deal 100 damage and draw 2 cards"
		},
		"Missile++": {
			cost: 0,
			location: "None",
			text: "Deal 150 damage and draw 3 cards"
		},
		"Multi Turret": {
			cost: 150,
			location: "None",
			text: "3 times, add a turret to a random tile"
		},
		"Multi Turret+": {
			cost: 200,
			location: "None",
			text: "4 times, add a turret to a random tile"
		},
		Power: {
			cost: 0,
			location: "Plant",
			text: "Mech gets +2 energy"
		},
		Rebuild: {
			cost: 100,
			location: "Rubble",
			text: "Rebuild a destroyed tile. It gets 2hp"
		},
		Reinforce: {
			cost: 50,
			location: "None",
			text: "2 times, a random tile gets +1hp"
		},
		"Reinforce+": {
			cost: 50,
			location: "None",
			text: "3 times, a random tile gets +1hp"
		},
		Rig: {
			cost: 0,
			location: "Any",
			duration: 2,
			text: "If this tile is destroyed in the next 2 turns, it deals 100 damage to the monster"
		},
		Safety: {
			cost: 0,
			location: "Plant",
			text: "Reduce plant's explosion damage by 3. Stacks twice"
		},
		Savings: {
			cost: 0,
			location: "None",
			text: "Any unspent money this turn carries over to next turn"
		},
		"Secret Project": {
			cost: 0,
			location: "Rubble",
			duration: 3,
			text: "Rebuild a destroyed tile. It gets 2hp. It gains stealth for 3 turns"
		},
		Shiny: {
			cost: 0,
			location: "Any",
			text: "Tile gets high threat"
		},
		Sift: {
			cost: 0,
			location: "None",
			text: "Discard 2 cards, then draw 2 cards"
		},
		Stealth: {
			cost: 0,
			location: "None",
			duration: 2,
			text: "Tile gets low threat for 2 turns"
		},
		Surge: {
			cost: 0,
			location: "Plant",
			text: "Deal 1 damage to your plant and 100 damage to the monster"
		},
		Sword: {
			cost: 0,
			location: "None",
			text: "Deal 20 damage",
			cast: function() { shoot(20); }
		},
		"Time Travel": {
			cost: 50,
			location: "None",
			text: "Take an extra turn after this one"
		},
		"Tough Turret": {
			cost: 0,
			location: "Any",
			text: "Tile gets +1hp and a turret"
		},
		Treasure: {
			cost: 0,
			location: "Bank",
			text: "When this bank is destroyed, gain $100 next turn only"
		},
		Turret: {
			cost: 30,
			location: "Any",
			text: "Tile gets another turret",
			cast: function() { currentTile.guns += 1; }
		},
		"Turret+": {
			cost: 70,
			location: "Any",
			text: "Tile gets 2 more turrets",
			cast: function() { currentTile.guns += 2; }
		},
		Volley: {
			cost: 0,
			location: "None",
			text: "Your turrets fire a volley"
		},
		"Volley+": {
			cost: 0,
			location: "None",
			text: "Your turrets fire two volleys"
		},
		Weld: {
			cost: 0,
			location: "None",
			text: "For each energy you have, a random tile gets +1 hp"
		}
	};

	var colorType = {
		Any: "#dddddd",
		Bank: "#ffffaa",
		None: "#ffaaff",
		Church: "#bbbbff",
		Plant: "#cc99ff",
		Farm: "#aaffaa",
		Rubble: "#bbbbbb"
	};

	var basicDecks = {
		"(Basic) Burn": "5Burn5Burn+5Concuss5Eat5Explosion5Missile5Missile+5Sword",
		"(Basic) Money": "5Income",
		"(Basic) Turrets": "5Turret"
	};

	var tileOrder = [
		"Wall", "Guns", "Bank", "Wall",
		"Bank", "Church", "Statue", "Guns",
		"Guns", "Plant", "Farm", "Bank",
		"Wall", "Bank", "Guns", "Wall"
	];

	var tileDictionary = {
		"Wall": {
			hp: 3,
			guns: 0,
			income: 0,
			image: "##<br>##<br>##"
		},
		"Guns": {
			hp: 2,
			guns: 1,
			income: 0,
			image: "&nbsp;/<br>/o<br>##"
		},
		"Bank": {
			hp: 2,
			guns: 0,
			income: 20,
			image: "$$<br>__<br>##"
		},
		"Farm": {
			hp: 4,
			guns: 0,
			income: 0,
			image: "__<br>__<br>__"
		},
		"Plant": {
			hp: 4,
			guns: 0,
			income: 0,
			image: "||<br>/\\<br>##"
		},
		"Statue": {
			hp: 2,
			guns: 0,
			income: 0,
			image: "\\o<br>||<br>/\\"
		},
		"Church": {
			hp: 4,
			guns: 0,
			income: 0,
			image: "/\\<br>||<br>/\\"
		}
	};

	var overlay = false;
	var i;
	var library = {};
	var total = 0;
	var deck, origDeck;
	var monsterHP, monsterMaxHP, rampageChance;
	var tiles = [];
	var gameMode;
	var currentCard, currentTile, nome;
	var income, money, turn, cardsPerTurn, energy;
	var saveMoney;
	
	drawMech();
	drawMonster();

	for (i=0; i < localStorage.length; i++) addToList(localStorage.key(i));
	for (var el in cardDictionary) {
		node = libraryItem.cloneNode(true);
		node.querySelector(".cardName").textContent = el;
		node.querySelector(".cardCost").textContent = "$" + cardDictionary[el].cost;
		node.querySelector(".cardLocation").textContent = cardDictionary[el].location;
		node.querySelector(".cardText").textContent = cardDictionary[el].text;
		node.querySelector(".card").style["background-color"] = colorType[cardDictionary[el].location];

		node2 = listItem.cloneNode(true);
		node2.querySelector(".listName").textContent = el;

		library[el] = {
			quantity: 0,
			node: node,
			node2: node2,
			addCards: addCards
		};
		
		createAddListener(node.querySelector(".add1"), library[el], 1, true);
		createAddListener(node.querySelector(".add5"), library[el], 5, true);
		createAddListener(node.querySelector(".remove1"), library[el], -1, true);
		createAddListener(node.querySelector(".remove5"), library[el], -5, true);
		createCardListener(node.querySelector(".card"), el);
		deckLibrary.appendChild(node);
		deckList.appendChild(node2);
	}
	libraryItem.style.display = "none";

	var tileDivs = document.querySelectorAll("#gameTileBox > div");
	for (i = 0; i < 16; i++) {
		node = tileDivs[i];
		tileName = tileOrder[i];
		tiles.push({
			node: node,
			nome: tileName,
			hp: 0,
			income: 0,
			guns: 0,
			addHP: function(amount) {
				this.hp += amount;
				this.node.querySelector(".tileHP").textContent = this.hp;
			}
		});
		newP = document.createElement("p");
		newP.innerHTML = tileDictionary[tileName].image;
		newP.classList.add("tileImage");
		node.appendChild(newP);
		newP = document.createElement("p");
		newP.textContent = tileName;
		node.appendChild(newP);
		newP = document.createElement("p");
		newP.classList.add("tileHP");
		node.appendChild(newP);
		createTileListener(tiles[i]);
	}

	function resetTile(tile) {
		tile.hp = tileDictionary[tile.nome].hp,
		tile.income = tileDictionary[tile.nome].income,
		tile.guns = tileDictionary[tile.nome].guns
		tile.node.querySelector(".tileHP").textContent = tile.hp;
		if (tile.nome == "Statue")
			tile.threat = 4;
		else
			tile.threat = 1;
	}

	function createTileListener(tile) {
		tile.node.onclick = function() {
			if (gameMode == "targetting" && legalTarget(tile)) {
				currentTile = tile;
				cast();
			} else if (gameMode == "casting") {

			}
		}
	}

	function legalTarget(tile) {
		if (tile.hp == 0) return (cardDictionary[nome].location == "Rubble");
		if (cardDictionary[nome].location == "Any") return true;
		return (cardDictionary[nome].location == tile.nome);
	}

	function createAddListener(button, obj, quantity, preventOnOverlay) {
		button.onclick = function(){
			if (overlay && preventOnOverlay) return;
			obj.addCards(quantity);
		};
	}

	function createCardListener(card, el) {
		card.onclick = function(){
			if(overlay) return;
			cardPopupDeck.style.display = "block";
			overlay = true;
			cardNameLg.textContent = el + " - $" + cardDictionary[el].cost + " - " + cardDictionary[el].location;
			cardTextLg.textContent = cardDictionary[el].text;
			createAddListener(cardPopupDeck.querySelector(".add1"), library[el], 1, false);
			createAddListener(cardPopupDeck.querySelector(".add5"), library[el], 5, false);
			createAddListener(cardPopupDeck.querySelector(".remove1"), library[el], -1, false);
			createAddListener(cardPopupDeck.querySelector(".remove5"), library[el], -5, false);
		};
	}

	function addCards(quantity) {
		newQ = this.quantity + quantity;
		if (newQ > 5) newQ = 5;
		if (newQ < 0) newQ = 0;
		addTotal(newQ - this.quantity);
		this.quantity = newQ;
		if (this.quantity == 0) this.node2.style.display = "none";
		else this.node2.style.display = "block";
		this.node2.querySelector(".listNum").textContent = this.quantity;
		this.node.querySelector(".libraryNum").textContent = this.quantity;
	}

	function addTotal(n) {
		total += n;
		totalCards.textContent = total;
		if (total < 40) totalCards.style.color = "red";
		if (total > 40) totalCards.style.color = "purple";
		if (total == 40) {
			totalCards.style.color = "green";
			saveNew.disabled = false;
			if (!delDeck.disabled) saveOver.disabled = false;
		} else {
			saveNew.disabled = true;
			saveOver.disabled = true;
		}
	}

	function cancelLg() {
		cardPopupDeck.style.display = "none";
		overlay = false;
	}

	function rules() {
		mainScreen.style.display = "none";
		ruleScreen.style.display = "block";
	}

	function newDeck() {
		deckNameDeck.textContent = "Untitled deck";
		saveOver.disabled = true;
		delDeck.disabled = true;
		resetLibrary();
		mainScreen.style.display = "none";
		deckScreen.style.display = "block";
	}

	function editDeck() {
		deckNameDeck.textContent = deckSelect.value;
		resetLibrary();
		if (basicName(deckSelect.value)) {
			saveOver.disabled = true;
			delDeck.disabled = true;
			loadDeck(basicDecks[deckSelect.value], false);
		} else {
			delDeck.disabled = false;
			loadDeck(localStorage.getItem(deckSelect.value), false);
		}
		mainScreen.style.display = "none";
		deckScreen.style.display = "block";
	}

	function resetLibrary() {
		for (el in library) {
			library[el].addCards(-5);
		}
	}

	function saveDeck() {
		var str = "";
		for (el in library)
			if (library[el].quantity > 0) str += library[el].quantity + el;
		return str;
	}

	function loadDeck(str, loadToDeck) {
		var substr = "";
		var c;
		var x = str.charAt(0);
		for (i = 1; i < str.length; i++) {
			c = str.charAt(i);
			if (c >= '0' && c <= '9') {
				if (loadToDeck) {
					for (var j = 0; j < Number(x); j++)
						deck.push(substr);
				} else
					library[substr].addCards(Number(x));
				x = c;
				substr = "";
			} else substr += c;
		}
		if (loadToDeck) {
			for (var j = 0; j < Number(x); j++)
				deck.push(substr);
		} else
			library[substr].addCards(Number(x));
	}

	function beginNormal() {
		monsterMaxHP = 10000;
		rampageChance = 0.5;
		newGame();
	}

	function beginHard() {
		monsterMaxHP = 200000;
		rampageChance = 0.6;
		newGame();
	}

	function newGame() {
		deck = [];
		if (basicName(deckSelect.value)) {
			loadDeck(basicDecks[deckSelect.value], true);
		} else {
			loadDeck(localStorage.getItem(deckSelect.value), true);
		}
		origDeck = deck.slice(0);
		shuffle();
		drawCard();
		drawCard();
		monsterHP = 0;
		addMonsterHP(monsterMaxHP);
		energy = 0;
		addEnergy(1);
		income = 40;
		turn = 0;
		cardsPerTurn = 2;
		saveMoney = false;
		for (i = 0; i < tiles.length; i++) resetTile(tiles[i]);
		newTurn();
		
		mainScreen.style.display = "none";
		gameScreen.style.display = "block";
	}

	function shuffle() {
		var temp, rnd;
		for (i = 0; i < deck.length; i++) {
			rnd = Math.floor(Math.random() * (deck.length - i)) + i;
			temp = deck[i];
			deck[i] = deck[rnd];
			deck[rnd] = temp;
		}
	}

	function newTurn() {
		for (i = 0; i < cardsPerTurn; i++) drawCard();
		setMode("casting");
		if (!saveMoney) money = 0;
		saveMoney = false;
		addIncome(10);
		addMoney(income);
		turn += 1;
		turnNum.textContent = "Turn " + turn;
	}

	function drawCard() {
		if (deck.length == 0) {
			deck = origDeck.slice(0);
			shuffle();
		}
		cardName = deck.pop();
		node = library[cardName].node.querySelector(".card").cloneNode(true);
		gameCardBox.appendChild(node);
		createCardInHandListener(node, cardName);
	}

	function createCardInHandListener(node, cardName) {
		node.onclick = function() {
			if (gameMode == "casting") {
				currentCard = this;
				nome = cardName;
				if (cardDictionary[cardName].location == "None") {
					cast();
				} else {
					setMode("targetting");
				}
			}
		};
	}

	function cast() {
		addMoney(-cardDictionary[nome].cost);
		cardDictionary[nome].cast();
		gameCardBox.removeChild(currentCard);
		setMode("casting");
	}

	function addMoney(amount) {
		money += amount;
		moneyNum.textContent = "$" + money;
	}

	function addIncome(amount) {
		income += amount;
		incomeNum.textContent = "Income: $" + income;
	}

	function addEnergy(amount) {
		energy += amount;
		energyNum.textContent = "Energy: " + energy;
	}

	function addMonsterHP(amount) {
		monsterHP += amount;
		numHP.textContent = monsterHP + "hp";
		innerHP.style.width = (100 * monsterHP / monsterMaxHP) + "%";
	}

	function shoot(amount) {
		addMonsterHP(-amount);
	}

	function endTurn() {
		if (gameMode != "casting") return;
		newTurn();
	}

	function setMode(str) {
		gameMode = str;
		if (str == "targetting" || str == "discarding") {
			cancelTarget.disabled = false;
		} else {
			cancelTarget.disabled = true;
		}
		if (str == "casting")
			phaseDetail.textContent = "Casting phase";
		if (str == "targetting")
			phaseDetail.textContent = "Target: " + cardDictionary[nome].location;
		if (str == "animating")
			phaseDetail.textContent = "Please wait...";
	}

	function cancelTargetF() { setMode("casting"); }

	function winToMain() {
		winScreen.style.display = "none";
		mainScreen.style.display = "block";
	}

	function loseToMain() {
		loseScreen.style.display = "none";
		mainScreen.style.display = "block";
	}

	function addToList(name) {
		var option = document.createElement("option");
		option.text = name;
		option.value = name;
		deckSelect.add(option);
	}

	function rulesToMain() {
		ruleScreen.style.display = "none";
		mainScreen.style.display = "block";
	}

	function deckToMain() {
		if (overlay) return;
		deckScreen.style.display = "none";
		mainScreen.style.display = "block";
	}

	function saveOverF() {
		localStorage.setItem(deckSelect.value, saveDeck());
		deckToMain();
	}

	function saveNewF() {
		if (overlay) return;
		overlay = true;
		saveTip.textContent = "Enter deck name"
		saveName.value = "";
		savePopup.style.display = "block";
		saveName.focus();
	}

	function saveCancel() {
		savePopup.style.display = "none";
		overlay = false;
	}

	function saveEnter() {
		if (event.key == "Enter") saveOK();
	}

	function saveOK() {
		if (saveName.value == "" || basicName(saveName.value) || localStorage.getItem(saveName.value)) {
			saveTip.textContent = "Invalid name. Enter deck name"
		} else {
			localStorage.setItem(saveName.value, saveDeck());
			addToList(saveName.value);
			savePopup.style.display = "none";
			overlay = false;
			deckSelect.options[deckSelect.length - 1].selected = true;
			deckToMain();
		}
	}

	function delDeckF() {
		localStorage.removeItem(deckSelect.value);
		for (i = 0; i < deckSelect.options.length; i++)
			if (deckSelect.options[i].selected) deckSelect.remove(i);
		deckToMain();
	}

	function basicName(name) {
		if (name == "(Basic) Burn" || name == "(Basic) Money" || name == "(Basic) Turrets") return true;
		return false;
	}

	function drawMech() {
		canvas = document.querySelector("#gameMechBox canvas");
		ctx = canvas.getContext('2d');
		
	}

	function drawMonster() {
		canvas = document.querySelector("#gameMonsterBox canvas");
		ctx = canvas.getContext('2d');
		
	}
</script>
</body>
</html>